<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>etc</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="title" content="etc"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2017-10-21T03:08+0000"/>
<meta name="author" content="Ubuntu"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../style.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">etc</h1>





<img id="handout-logo" src="../img/etc_logo.svg" />
<div id="handout">


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Introduction to the competition</a></li>
<li><a href="#sec-2">2 Getting started</a></li>
<li><a href="#sec-3">3 The competition structure</a></li>
<li><a href="#sec-4">4 Some golden rules</a></li>
<li><a href="#sec-5">5 Technical details</a></li>
<li><a href="#sec-6">6 Advice from the devs</a></li>
<li><a href="#sec-7">7 Advice from the traders</a></li>
<li><a href="#sec-8">8 FAQ</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Introduction to the competition</h2>
<div class="outline-text-2" id="text-1">

<p><code>etc</code> is a programming competition. The goal is to write a program that will
make (fake) money by trading securities on a fake financial exchange. Other
participants in the market will be other people's programs, and also some
programs provided by us (the "marketplace bots"). Before continuing, you should
make sure you are familiar with some basic finance lingo that is discussed in
this document. You can find a brief intro to finance <a href="finance101.html">here</a>
(make sure to read this before moving on!)
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Getting started</h2>
<div class="outline-text-2" id="text-2">


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Developing your bot                              </h3>
<div class="outline-text-3" id="text-2-1">

<p>We will be running this competition on Amazon EC2.
</p>
<p>
Each team will receive one Ubuntu Linux box in the cloud which is yours and
yours alone, which we'll call your "bot box". You can develop there if you wish,
or you can develop on your laptop and upload to your box. If you choose the
latter route, be sure to check that your binary actually works in the cloud.
</p>
<p>
When we are ready to begin the competition, we will tell you the (public) IP
address of your bot box. To get started, log in to the box by opening a terminal
on your laptop and using ssh:
</p>
<pre class="example">
ssh ubuntu@54.154.27.172 # Replace with your bot box's public IP
</pre>


<p>
If you'd like, you can change your password to something more memorable at this
point using the standard unix utility "passwd". Alternatively, you can add an
SSH key to "~/.ssh/authorized_keys" so you don't have to type a password.
</p>
</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Do not remove our SSH authorized keys on your bot box     </h3>
<div class="outline-text-3" id="text-2-2">

<p> We need to be able to SSH into the bot boxes in order to connect them to the
 production exchanges. If you remove us, your bot will not be able to compete.
</p>
</div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Testing your bot</h3>
<div class="outline-text-3" id="text-2-3">

<p>You have access to three test exchanges where you can test out your bot.
The three exchanges run slightly different versions of the marketplace. On the
zeroth exchange ("0-prod-like"), the marketplace runs at the true competition
speed and simulates real rounds by restarting every five minutes. On the first
exchange ("1-slower"), the marketplace runs more slowly and does not restart.
On the second exchange ("2-empty"), there is no marketplace &ndash; the exchange is
empty, ready for you to play around with.
</p>
<p>
The same symbols are available on the test exchanges as on the prod exchanges.
Each trial will have the same starting prices for all of the symbols, but the
price path after that is random &ndash; you should not expect them to remain
consistent between the test and prod exchanges, nor even between two different
games on a prod exchange.
</p>
</div>

</div>

<div id="outline-container-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Connecting to the exchange</h3>
<div class="outline-text-3" id="text-2-4">

<p>You must establish a TCP connection to the exchange. There is a different port
depending on whether you want to use the plain-text protocol or the JSON
protocol. The technical details surrounding the exchange protocol can be found <a href="#sec-5-1">here</a>.
</p>
<p>
Each team may have at most one connection open to an exchange at any time.
</p>
<p>
If you have never done any socket programming before, you might want to Google
for some tutorials for writing TCP clients. Both the "plain" and JSON
protocols are line based&mdash;that is, every message ends with a newline&mdash;so
you might want to look for advice about line buffering. Here are some
starting points for a few languages:
</p><ul>
<li><a href="../code/sample-bot.py">Python</a>
</li>
<li><a href="../code/sample-bot.cpp">C/C++</a>
</li>
<li><a href="../code/Sample-bot.java">Java</a>
</li>
<li><a href="../code/sample_bot.ml">OCaml</a>
</li>
</ul>


<p>
Note that the model is different to a request/response protocol like HTTP: you
connect, and the server continually sends you data as soon as an event (e.g. a
trade or new order) occurs. There is no need (and indeed, no way) to regularly
ask the server what the current status is.
</p>


</div>

<div id="outline-container-2-4-1" class="outline-4">
<h4 id="sec-2-4-1"><span class="section-number-4">2.4.1</span> Test exchange host and ports                    </h4>
<div class="outline-text-4" id="text-2-4-1">

<p>If your team name is ORANGE, then your test exchanges can be found on the host
"test-exch-orange". If you need an IP address, you can find it like so:
</p>
<pre class="example">
ubuntu@bot-orange:~$ host test-exch-orange
test-exch-orange has address 10.0.109.63   (for example)
</pre>


<p>
The plain text ports for the prod-like, slower, and empty exchanges are 20000,
20001 and 20002 respectively; the JSON ports are 25000, 25001 and 25002.
</p>
<p>
For example, you can connect to the prod-like test exchange using netcat:
</p>
<pre class="example">
$ nc test-exch-teamname 20000  # Replace "teamname" with your team name here ...
HELLO TEAMNAME                 # ... and here (uppercase)
</pre>


</div>
</div>

</div>

<div id="outline-container-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> Monitoring your bot                    </h3>
<div class="outline-text-3" id="text-2-5">

<p>You can see the current books on the exchanges, as well as all positions
and the history of trades. Use your team name and password to log in.
</p>
<p>
<a href="http://tsinghua.etc.janestreet.com:8080">http://tsinghua.etc.janestreet.com:8080</a>
</p>
<p>
At this point, you should manually connect to a test exchange, place some
orders (using netcat), and observe the exchange state at the above URL.
</p>
</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> The competition structure</h2>
<div class="outline-text-2" id="text-3">

<p>The competition consists of a series of five minute matchups on production
exchanges. In each matchup, you and another team compete to be the best market
maker, providing liquidity to a third bot called the "marketplace".
</p>
<p>
The marketplace has an internal random process for each product which represents
the fair value of that product. (At the end of the matchup, the portfolio you
have amassed will be evaluated using these fair values &ndash; <a href="#sec-3-3">see below</a>). The
marketplace will send some orders around the fair value. Some orders will, like
yours, be orders intended to provide liquidity. Other orders from the
marketplace will be emulating liquidity demanders &ndash; people who just wish to
buy or sell a certain amount, and don't care too much about the price they get.
</p>
<p>
In particular, it is not the marketplace's job to make money. Although
technically speaking the marketplace is a "bot", its positions or pnl is not
very relevant. The marketplace is meant to represent a whole bunch of different
market participants, some of whom are more price-sensitive than others. This is
representative of the fact that we mentioned in the finance intro &ndash; it's unhelpful
to think of trading as a zero-sum game.
</p>
<p>
You can choose to participate, or not, in a given matchup, or join after the
matchup begins, or give up halfway through &ndash; whatever you want.
</p>
<p>
At the end of a matchup, the exchange closes and then reopens shortly
afterwards for the next matchup, where you'll be playing alongside a different team.
We reset your cash and positions too. You'll want to make sure your
bot can reconnect automatically when the exchange re-opens for the
next matchup.
</p>

</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Your portfolio</h3>
<div class="outline-text-3" id="text-3-1">

<p>You have an account (like a bank account) that can hold both currency and shares in
financial securities. At the beginning of each matchup your account is empty --
no currency, no shares. The number of shares of a particular security that you own
is called your <i>position</i> in that security. If you buy a share by paying a currency,
your position in that currency goes down and your position in that stock goes up.
If you sell, the opposite. In this competition, the currency that we'll measure profit
and loss in is USD (US dollars), so we may refer to it as "cash" in this handout.
</p>
<p>
Note that it is possible to have a negative position in any product &ndash; you can
effectively borrow money or shares from the bank at which you hold the account.
</p>
</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Risk limits</h3>
<div class="outline-text-3" id="text-3-2">

<p> Your position in each security will be limited, with the limits
 depending on which stock or currency you're trading &mdash; see the table below.
 For example, in HSBC, the position limit is 10 shares; that means
 your position in HSBC may never be less than -10 or greater than
 +10.  In the real world, our positions are limited by the availablity
 of stock borrow, capital constraints, and crash risk.  Obviously, the
 greater your position, the more exposed you are to a crash in this product.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">symbol</td><td class="left">limit</td></tr>
<tr><td class="left">USD</td><td class="left">None</td></tr>
<tr><td class="left">HKD</td><td class="left">20,000,000</td></tr>
<tr><td class="left">GBP</td><td class="left">200,000</td></tr>
<tr><td class="left">HSBC</td><td class="left">10</td></tr>
<tr><td class="left">FIVEHK</td><td class="left">10</td></tr>
</tbody>
</table>


<p>
 These are enforced by the exchange: if you send an order such that if it and all
 your other orders in the same symbol and direction were fully filled it would put
 you over your position limits, then your order will be rejected.
</p>
<p>
 There are no direct limits on your cash (USD) balance in either direction.
</p>
<p>
 However, there are limits on your profit/loss. If at some point you get to a
 stage where your current pnl is too negative, you will be determined to have
 "blown out". We'll stop your participation in that matchup there, and close any
 positions you have at the fair value at that time. The limit is -30,000.
</p>
</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Profit and loss</h3>
<div class="outline-text-3" id="text-3-3">

<p>Your profit/loss (aka "pnl") can be computed by taking the amount of cash in your account
(e.g. if you buy a product for 10, and then sell it for 12, you would have 2 cash in your
account), and adding the value of all your holdings (again, as determined by the
marketplace's internal notion of fair value). The main goal is to maximize your pnl over all
the rounds you participate in. Another important goal is to avoid doing very poorly in any given
round. This is reflective of the real world: you may do particularly well on some days, but you
really want to avoid losing all your money on any given day because then you're out of a job.
</p>
</div>

</div>

<div id="outline-container-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> Rounds</h3>
<div class="outline-text-3" id="text-3-4">

<p>A production round will last for five minutes, after which the exchange will shut down.
A new exchange will shortly start up and be available on the same address.
</p>
<p>
We don't carry your positions forward from one game to the next.
</p>
<p>
<b>BE CAREFUL</b> &ndash; you should not assume that the values of securities in one game
will be anywhere near the values in a previous game.
</p>
<p>
If your bot quits once its connection to the exchange goes down, you might want
to run your bot in a bash loop so that it automatically reconnects:
</p>
<pre class="example">
while true; do ./bot.exe; sleep 5; done
</pre>



</div>

<div id="outline-container-3-4-1" class="outline-4">
<h4 id="sec-3-4-1"><span class="section-number-4">3.4.1</span> Running in production                           </h4>
<div class="outline-text-4" id="text-3-4-1">

<p> When you're ready to run your bot in production, have it connect to
 the host "production" on port 20000 (plain text protocol) or port 25000 (JSON protocol).
</p>
<p>
 ("production" is a hostname that will resolve via DNS. If you need an IP
 address, use "1.1.1.1").
</p>
<p>
 You can see the results from your previous production round here:
</p>
<p>
 <a href="http://tsinghua.etc.janestreet.com:8080/go/last-round-results">http://tsinghua.etc.janestreet.com:8080/go/last-round-results</a>
</p>
</div>
</div>

</div>

<div id="outline-container-3-5" class="outline-3">
<h3 id="sec-3-5"><span class="section-number-3">3.5</span> Timetable and scoring</h3>
<div class="outline-text-3" id="text-3-5">


<p>
There will be two distinct competitions, with two distinct prizes.
</p>
<p>
The first will run (more-or-less) continuously between 11:30 am and 7:30 pm.
Here's how your score for each individual matchup will contribute to your
overall competition score.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" /><col class="left" /><col class="right" /><col class="left" /><col class="left" />
</colgroup>
<thead>
<tr><th scope="col" class="left">Phase</th><th scope="col" class="left">Length</th><th scope="col" class="right">%</th><th scope="col" class="left">Start</th><th scope="col" class="left">End</th></tr>
</thead>
<tbody>
<tr><td class="left">A</td><td class="left">1.5hr</td><td class="right">20%</td><td class="left">11:30 am</td><td class="left">1:00 pm</td></tr>
<tr><td class="left">B</td><td class="left">2 hr</td><td class="right">5%</td><td class="left">1:00 pm</td><td class="left">2:30 pm</td></tr>
<tr><td class="left">C</td><td class="left">2 hr</td><td class="right">20%</td><td class="left">2:30 pm</td><td class="left">4:30 pm</td></tr>
<tr><td class="left">D</td><td class="left">2 hr</td><td class="right">30%</td><td class="left">4:30 pm</td><td class="left">6:30 pm</td></tr>
<tr><td class="left">E</td><td class="left">1 hr</td><td class="right">25%</td><td class="left">6:30 pm</td><td class="left">7:30 pm</td></tr>
</tbody>
</table>


<p>
At 7:30 pm we will transition into the second competition. All scores are
reset. The winner is the team that has the highest cumulative score across this
final hour.
</p>
</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Some golden rules</h2>
<div class="outline-text-2" id="text-4">

<ol>
<li>You must not attempt to manipulate other people's bots.
</li>
<li>You must not attempt to manipulate the exchange.
</li>
<li>Your bot should be entirely written by your team today (standard libraries are fine).
</li>
</ol>


<p>
You are building a bot to provide a service to the marketplace bots, and
attempting to do so in the best possible way.
</p>
<p>
Some examples of what would count as manipulation:
</p><ul>
<li>Trading with yourself in order to publish "fake" trades to all participants,
  in an attempt to have them believe the trade price is a reasonable fair value
  for the security.
</li>
<li>Sending orders to the exchange where you know at the time of sending that you
  want to cancel the orders and never let them trade. If you think it would be
  a bad idea to buy security for price P, then you shouldn't send orders to
  buy that security for price P.
</li>
</ul>


<p>
Don't download a bot from the internet and run that instead of writing a bot. Or
other silly things like that. Basically, don't be a jerk.
</p>
<p>
We reserve the right to subtract some from your bot's profit, or disqualify you
completely, if we feel you've violated these rules. Obviously they are somewhat
vague. Please come talk to us if you have any concerns. If you find a bug in the
exchange, please tell us. If you think someone else has been deliberately
manipulating your bot, please tell us too.
</p>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Technical details</h2>
<div class="outline-text-2" id="text-5">


</div>

<div id="outline-container-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> The exchange protocol</h3>
<div class="outline-text-3" id="text-5-1">

<p>What sorts of messages form the protocol between the exchange and you?
</p>
<p>
You to exchange:
</p><ul>
<li>Hello: the first message you must send, identifying yourself to the exchange
</li>
<li>Add: a request to buy or sell a security; "add order"
</li>
<li>Cancel: a request to remove from the book some previously-placed order that
  hasn't traded yet
</li>
<li>Convert: a request to convert an ADR (from or to its underlying basket)
</li>
</ul>


<p>
Exchange to you (private):
</p><ul>
<li>Hello: the first message the exchange will send you when you connect, containing your positions
</li>
<li>Ack: "your order was successfully placed on the book" (this does not mean it traded!)
</li>
<li>Reject: "your order wasn't valid for this reason: &hellip;" (e.g. negative price,
  malformed syntax etc.)
</li>
<li>Error: an error related to your bot that's not associated with a specific order
</li>
<li>Out: following a cancel or once your order is completely filled, "your order
  is no longer on the book"
</li>
<li>Fill: "your order traded"
</li>
</ul>


<p>
Exchange to you (public):
</p><ul>
<li>Book: "the current state of the book is&hellip;"
</li>
<li>Trade: "two (anonymous) people traded at price X"
</li>
<li>Open: "the market for a specific security has opened"
</li>
<li>Close: "the market for a specific security has closed"
</li>
</ul>


<p>
Conversions are described later.
</p>
<p>
You have free choice of using a plain-text protocol, or JSON; they will be
available on different TCP ports (as mentioned.
</p>

</div>

<div id="outline-container-5-1-1" class="outline-4">
<h4 id="sec-5-1-1"><span class="section-number-4">5.1.1</span> Client messages</h4>
<div class="outline-text-4" id="text-5-1-1">





<pre class="example">HELLO TEAMNAME
ADD ID SYMBOL BUY|SELL PRICE SIZE
CONVERT ID SYMBOL BUY|SELL SIZE
CANCEL ID

{"type": "hello", "team": "ASDF"}
{"type": "add", "order_id": N, "symbol": "SYM", "dir": "BUY", "price": N, "size": N}
{"type": "convert", "order_id": N, "symbol": "SYM", "dir": "BUY", "size": N}
{"type": "cancel", "order_id": N}
</pre>


</div>

</div>

<div id="outline-container-5-1-2" class="outline-4">
<h4 id="sec-5-1-2"><span class="section-number-4">5.1.2</span> Server messages</h4>
<div class="outline-text-4" id="text-5-1-2">





<pre class="example">HELLO SYM:POSN SYM:POSN ...
OPEN SYM SYM SYM ...
CLOSE SYM SYM SYM ...
ERROR MSG
BOOK SYMBOL BUY PRICE:SIZE PRICE:SIZE ... SELL PRICE:SIZE PRICE:SIZE ...
TRADE SYMBOL PRICE SIZE
ACK ID
REJECT ID MSG
FILL ID SYMBOL DIR PRICE SIZE
OUT ID

{"type":"hello","symbols":[{"symbol":"SYM","position":N}, ...]}
{"type":"open","symbols":["SYM1", "SYM2", ...]}
{"type":"close","symbols":["SYM1", "SYM2", ...]}
{"type":"error","error":"MSG"}
{"type":"book","symbol":"SYM","buy":[[PRICE,SIZE], ...],"sell":[...]}
{"type":"trade","symbol":"SYM","price":N,"size":N}
{"type":"ack","order_id":N}
{"type":"reject","order_id":N,"error":"MSG"}
{"type":"fill","order_id":N,"symbol":"SYM","dir":"BUY","price":N,"size":N}
{"type":"out","order_id":N}
</pre>


<p>
Please note that the protocol is case sensitive, and you should imitate the
above.
</p>
</div>
</div>

</div>

<div id="outline-container-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> "Types"</h3>
<div class="outline-text-3" id="text-5-2">

<ul>
<li>DIR: A direction is one of "BUY" or "SELL".
</li>
<li>TEAMNAME, SYMBOL: Team names and symbols are <b>uppercase</b> alpha only.
</li>
<li>PRICE, SIZE: Prices and sizes are <b>positive</b> integers strictly less
  than 1000000.
</li>
<li>POSN: Positions are integers (at least smaller than 2^32)
</li>
<li>ID: Order ids are non-negative integers (at least smaller than 2^32)
</li>
<li>MSG: Arbitrary strings potentially including spaces (but they won't contain
  newlines or nulls or anything tricksy).
</li>
</ul>


</div>

</div>

<div id="outline-container-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Handshake</h3>
<div class="outline-text-3" id="text-5-3">

<p>You must issue the "hello" message first, and you must be accurate with your
team name &mdash; don't impersonate someone else!
</p>
<p>
You will immediately receive a "hello" from the exchange (or an error). The
hello will include your current positions in each symbol (including USD). At
the start these will all be zero; these numbers are only useful to you if you
crash and reconnect (which you shouldn't be planning on doing!).
</p>
</div>

</div>

<div id="outline-container-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Orders</h3>
<div class="outline-text-3" id="text-5-4">

<p>You, the client, must pick unique identifiers for your orders and send them along
with the rest of the details in the "add message". Ack, reject, fill and out
messages will refer to the order by this identifier. It need not be globally
unique, merely unique to your connection to the exchange. Besides these
restrictions, you may pick them however you like, remembering that they must be
non-negative integers.
</p>
<p>
To, say, enter a buy order for HSBC with price 1902 (in the relevant currency,
USD in this case) and size 5, issue:
</p>
<pre class="example">
 ADD 123 HSBC BUY 1902 5
</pre>


<p>
You will receive either:
</p>
<pre class="example">
 ACK 123
</pre>


<p>
or:
</p>
<pre class="example">
 REJECT 123 REASON
</pre>


<p>
where "REASON" might be one of the strings mentioned above.
</p>
<p>
Suppose that your order could trade immediately with a "sell 1 at $1901" order
that was resting on the market. Shortly after the ack you would receive:
</p>
<pre class="example">
 FILL 123 HSBC BUY 1901 1
</pre>


<p>
The fill contains a reminder of what the order's symbol and direction, the
price that the order traded at, and the number of shares that traded.
</p>
<p>
Note that your order is still on the market, but now its size is 4.
</p>
<p>
When your order has been fully filled, you will also receive an "out" message.
Continuing the above example, if a little later on, someone else submitted a
large low sell order, you would receive
</p>
<pre class="example">
 FILL 123 HSBC BUY 1902 4
 OUT 123
</pre>


<p>
Note that at roughly the same time as you receive a "fill" message, you will
also receive a "trade" message.
</p>
<p>
To cancel an order, issue
</p>
<pre class="example">
 CANCEL 123
</pre>


<p>
The reply will be
</p>
<pre class="example">
 OUT 123
</pre>


<p>
Provided you have completed the handshake, "cancel" messages never fail: you
will always receive an "out" reply, even if the server does not recognise that
order. If a cancel and a fill race (and the cancel loses), you might receive
two outs for the same order id. Furthermore, you might receive an out for an
order that was neither cancelled by you nor fully filled (an "unsolicited
out"), if the exchange decides it wants to cancel your order for some specific
reason. You may wish to ignore outs you don't recognise.
</p>
<p>
Conversions to and from an ADR are done using the CONVERT message, which is
similar to ADD but without a price:
</p>
<pre class="example">
 CONVERT 4 HSBC BUY 10
</pre>


<p>
"BUY" means you receive the ADR (HSBC) and give out the underlying stock (FIVEHK).
"SELL" means you give out the ADR (HSBC) and receive the underlying stock (FIVEHK).
In both cases, you pay a conversion fee, which is 10 USD, regardless of the size of
your conversion.
You are not allowed to convert if it would put you over any position limit
&ndash; in the ADR or in the stock. The order ID for conversions shares a namespace
with orders.
</p>
<p>
The reply will be either an ACK message or a REJECT message indicating whether
the conversion was successful or not. It is not possible for a conversion to
partially succeed.
</p>
<p>
The corresponding JSON for the messages above would be:
</p>
<pre class="example">
 {"type": "add", "order_id": 123, "symbol": "HSBC", "dir": "BUY", "price": 1902, "size": 5}
 {"type": "ack", "order_id": 123}
 {"type": "reject", "order_id": 123, "error": "REASON"}
 {"type": "fill", "order_id": 123, "symbol": "HSBC", "dir": "BUY", "price": 1901, "size": 1}
 {"type": "fill", "order_id": 123, "symbol": "HSBC", "dir": "BUY", "price": 1902, "size": 4}
 {"type": "out", "order_id": 123}
 {"type": "cancel", "order_id": 123}
</pre>


</div>

</div>

<div id="outline-container-5-5" class="outline-3">
<h3 id="sec-5-5"><span class="section-number-3">5.5</span> Public feed</h3>
<div class="outline-text-3" id="text-5-5">

<p>Trade and book messages constitute the anonymised public feed.
</p>
<pre class="example">
 TRADE HSBC 1902 4
 {"type":"trade","symbol":"HSBC","price":1902,"size":4}
</pre>


<p>
means that 4 shares of HSBC have traded at price $1902 between two people (or
one person with themselves).
</p>
<pre class="example">
 BOOK HSBC BUY 1899:12 1898:100 1895:1 SELL 1901:4 1902:15 1903:100
 {"type":"book","symbol":"HSBC","buy":[[1899,12],[1998,100],[1895,1]],"sell":[[1901,4],[1902,15],[1903,100]]}
</pre>


<p>
means that one or more people are willing to buy HSBC for $1899, and the sum of
the sizes of those orders is 12. (Willing to buy 100 shares of HSBCfor $1898,
etc.) On the other side, there are people willing to sell up to 4 shares at
$1901.
</p>
<p>
The book will be truncated to 15 price levels. It will be sorted
most-aggressive-first (i.e. bids are high-to-low, offers are low-to-high), so
that the best bid and offer are in the location indicated by "BEST" below:
</p>
<pre class="example">
 BOOK HSBC BUY BEST OTHERS... SELL BEST OTHERS...
 {"type":"book","symbol":"HSBC","buy":[BEST, ...],"sell":[BEST, ...]}
</pre>


<p>
There are no guarantees about when you'll receive these messages in relation
to the private ones. Notably:
</p><ul>
<li>when you add an order, the "book" update to include your order may arrive
  before or after the ack (moreover, not necessarily immediately before or
  after)
</li>
<li>similarly for trade &amp; fill messages
</li>
</ul>


</div>

</div>

<div id="outline-container-5-6" class="outline-3">
<h3 id="sec-5-6"><span class="section-number-3">5.6</span> Errors</h3>
<div class="outline-text-3" id="text-5-6">

<p>"Error" and "reject" messages are the server complaining about your bot.
If the server is able to associate the error with an "add" message, then
it will send a "reject" with the order id that failed and the error message.
Otherwise, you will simply receive an "error".
</p>
<p>
If the server detects that you have disconnected then all of your open orders
will be canceled.
</p>
</div>

</div>

<div id="outline-container-5-7" class="outline-3">
<h3 id="sec-5-7"><span class="section-number-3">5.7</span> Available symbols</h3>
<div class="outline-text-3" id="text-5-7">

<p>The following symbols are available:
</p><ul>
<li>USDHKD (10,000 USD, priced in HKD)
</li>
<li>GBPUSD (10,000 GBP, priced in USD)
</li>
<li>GBPHKD (10,000 GBP, priced in HKD)
</li>
<li>FIVEHK (1 share of FIVEHK, priced in HKD)
</li>
<li>HSBC   (1 share of HSBC, priced in USD)
</li>
</ul>


<p>
For the currency pairs (USDHKD, GBPUSD, GBPHKD), one "unit" represents 10,000
of the first currency, priced in the second. For example, sending
</p><pre class="example">
 ADD 5 GBPUSD BUY 13000 1
</pre>

<p>and getting filled means you pay 13,000 USD, and receive 10,000 GBP in exchange.
</p>
<p>
One USD is worth precisely 8 HKD at all times. This means that the marketplace
fair value is precisely 80,000, but it could possibly trade at other prices.
</p>
<p>
FIVEHK is a regular stock, priced in HKD.
</p>
<p>
The symbol HSBC is an ADR of FIVEHK.
</p>
<p>
1 share of HSBC can be converted to/from 1 share of FIVEHK.
The conversion fee for HSBC is a fixed cost of 10 per conversion
(regardless of the number of shares converted).
</p>
</div>

</div>

<div id="outline-container-5-8" class="outline-3">
<h3 id="sec-5-8"><span class="section-number-3">5.8</span> Market hours                    </h3>
<div class="outline-text-3" id="text-5-8">


<p>
You cannot add orders in a symbol when it is closed (or "halted"): attempting
to do so will produce a reject.
</p>
<p>
The exchange will start with all symbols closed. It will then open, sending you
an "open" message to inform you of this, and then after some period of time
close (sending you a "close" message). Shortly afterwards it will shut down,
simply closing its connection to you.
</p>
</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Advice from the devs</h2>
<div class="outline-text-2" id="text-6">


</div>

<div id="outline-container-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Keep it simple</h3>
<div class="outline-text-3" id="text-6-1">

<p>Most of the time, a complicated algorithm is hard to think about and
hard to write.
</p>
</div>

</div>

<div id="outline-container-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> Start trading early</h3>
<div class="outline-text-3" id="text-6-2">

<p>It's a good idea to find a strategy to make you money, and continue
using it throughout the competition. You should try to provide liquidity early.
</p>
</div>

</div>

<div id="outline-container-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> If something seems like it should be solved for you already, it probably is</h3>
<div class="outline-text-3" id="text-6-3">

<p>In past competitions, people have spent lots of time doing low-level things like
writing line parsers for the TCP protocol. Every language that's been used in
past <code>etc</code> events has had the native ability, or had libraries readily available
to read whole lines from a socket.
</p>
</div>

</div>

<div id="outline-container-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> Spend some time to make sure you can debug your bot</h3>
<div class="outline-text-3" id="text-6-4">

<p>When there's a problem with your bot, make sure you can figure out
what's going wrong. Many languages have built-in logging frameworks
or great 3rd party libraries for these. Printf can also be your friend.
</p>
</div>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Advice from the traders</h2>
<div class="outline-text-2" id="text-7">


</div>

<div id="outline-container-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Step 1: trading USDHKD</h3>
<div class="outline-text-3" id="text-7-1">

<p>USDHKD should be pretty straightforward to trade for positive
expectancy, since its fair value is known!  Buy a unit for less than 80000
or sell it for more than that and you're golden.  Fortunately,
there's a lot more of interest to come.
</p>
</div>

</div>

<div id="outline-container-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> Step 2: trading the HSBC/FIVEHK ADR pair</h3>
<div class="outline-text-3" id="text-7-2">

<p>These are two stocks for which the fair value changes over time but is always
equal across the two.  Note that because HSBC trades in USD, FIVEHK trades in
HKD, and one USD is always worth 8 HKD, this means that the fair price of FIVEHK
should be 8 times that of HSBC.
</p>
<p>
HSBC is the more liquid side, and so you'll notice that it's a better source of
price information, but its a lot
harder to make money trading.  Protip: use the more liquid leg (HSBC) to
price out and trade the less liquid leg (FIVEHK).  The position bounds
are tight, though, so you'll have to convert and trade both stocks if
you want to maximize your expected profits.
</p>
</div>

</div>

<div id="outline-container-7-3" class="outline-3">
<h3 id="sec-7-3"><span class="section-number-3">7.3</span> Step 3: the currency triangle</h3>
<div class="outline-text-3" id="text-7-3">

<p>You can similarly price GBPHKD in terms of GBPUSD (and USDHKD).  We'll leave you
to figure out the details.
</p>
</div>

</div>

<div id="outline-container-7-4" class="outline-3">
<h3 id="sec-7-4"><span class="section-number-3">7.4</span> Get going!</h3>
<div class="outline-text-3" id="text-7-4">

<p>The earlier you can get something simple that works out into the
marketplace, the more time your bot can spend making profits.  Work
on version 2.0 while you're making money with version 1.0.
</p>
</div>

</div>

<div id="outline-container-7-5" class="outline-3">
<h3 id="sec-7-5"><span class="section-number-3">7.5</span> Maximize!</h3>
<div class="outline-text-3" id="text-7-5">

<p>Keep tuning and improving your algorithms; maybe a simple change to one of your
parameters could double your profits per round.  Use the test exchange to experiment;
the marketplace bots there are exactly the same as on the competition exchange.
</p>
</div>
</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> FAQ</h2>
<div class="outline-text-2" id="text-8">


</div>

<div id="outline-container-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> My messages are being ignored!</h3>
<div class="outline-text-3" id="text-8-1">

<p>You need to send a newline after each message (even when using the JSON protocol).
</p>
</div>

</div>

<div id="outline-container-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> Can I use &lt;favorite library&gt; or &lt;favorite search engine&gt;?</h3>
<div class="outline-text-3" id="text-8-2">

<p>You are welcome (and encouraged!) to search for solutions to problems, standard
libraries etc. online. But please don't download bot code, post solutions
online, get someone to write code for you, or anything like that.
</p>

</div>
</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2017-10-21T03:08+0000</p>
<p class="author">Author: Ubuntu</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
